<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form"%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags"%>
<%@ taglib prefix="apptags" tagdir="/WEB-INF/tags"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<script type="text/javascript" src="js/mainet/file-upload.js"></script>
<script type="text/javascript" src="js/mainet/validation.js"></script>
<script type="text/javascript" src="js/mainet/jQueryMaskedInputPlugin.js"></script>
<script type="text/javascript" src="js/care/complaint-report.js"></script>
<script type="text/javascript" src="assets/libs/excel-export/jquery.tablesorter.js"></script>
<script type="text/javascript" src="assets/libs/excel-export/jquery.tablesorter.pager.js"></script>
<script>
$(function() {
	$(".table").tablesorter().tablesorterPager({
		container: $(".ts-pager"),
		cssGoto  : ".pagenum",
		removeRows: false,
 	});

	var count = $("#report-table thead th").length;
	$('#report-table tfoot tr th.ts-pager').attr('colspan',count);
});
</script>

    <apptags:breadcrumb></apptags:breadcrumb>
    <!-- Start Content here -->
    <div class="content animated slideInDown">
      <div class="widget invoice" id="report-print">
        <div class="widget-content padding" >
          <form action="" method="get">
	          	<div class="row">
	              <div class="col-xs-3"><img src="${userSession.orgLogoPath}" width="80"></div> 	
	              <div class="col-xs-6 text-center">
	                <h3 class="margin-bottom-0">${command.complaintReport.orgName}</h3>
	                <p class="excel-title">${command.complaintReport.title}</p>
	              </div>
	              <!-- D#127292 -->
					<c:choose>
						<c:when test="${command.kdmcEnv eq 'Y'}">
							<div class="col-xs-3 text-right"></div>
						</c:when>
						<c:otherwise>
							<div class="col-xs-3 text-right"><img src="${userSession.orgLogoPath}" width="80"></div>
						</c:otherwise>
					</c:choose>
	            </div>
	            <div class="row text-center">
	            	<p>
	                	<span class="green"> <spring:message code="care.reports.grade.a.note"/> </span>
	                	<span class="blue"> <spring:message code="care.reports.grade.b.note"/> </span>
	                	<span class="orange"> <spring:message code="care.reports.grade.c.note"/> </span>
	                	<span class="red"> <spring:message code="care.reports.grade.d.note"/> </span>
	                </p>
	            </div>
	           
	           	<div class="row margin-top-50">
		            <div class="container">
		              <div class="pull-left"><spring:message code="care.reports.fromDate" text="From Date"/>: ${command.complaintReport.fromDate}</div>
		              <div class="pull-right"><spring:message code="care.reports.toDate" text="To Date"/>: ${command.complaintReport.toDate}</div>
		             </div>
	            </div>
	             
	            <div class="row clear">
		            <div class="container">
		              <div class="pull-left"><spring:message code="care.reports.department" text="Department"/>: ${command.complaintReport.departmentName}</div>
	 	              <div class="pull-right"><spring:message code="care.reports.complaintType" text="Complaint Type"/>: ${command.complaintReport.complaintType}</div>
	 	            </div>
	            </div>
	            
	            <div class="row wzfilters clear">
		            <div class="container">
						<apptags:lookupFieldSet baseLookupCode="${command.prefixName}" hasId="true" pathPrefix="complaintReport.codIdOperLevel" showOnlyLabel="true"/>	
					</div>
				</div> 
	            
	             <div class="row clear">
	            	 <div class="container">
	             		 <div class="pull-left"><spring:message code="care.reports.generatedDate" text="Generated Date"/>: ${command.complaintReport.dateTime}</div>
		            	 <div class="pull-right"><spring:message code="care.reports.generatedBy" text="Generated By"/>: ${userSession.employee.empname} ${userSession.employee.empmname} ${userSession.employee.emplname}</div>
		            </div>
	             </div>
	            
	            <div id="export-excel">
 				<div class="table-responsive margin-top-10">
					<table class="table table-bordered table-condensed tablesorter" id="report-table">
						<thead>
							<tr>
								<th rowspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.SrNo" text="Sr. No."/></th>
								<th rowspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.department" text="Department"/></th>
								<th rowspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.received" text="Received"/></th>
								<th colspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.pending" text="Pending"/></th>
								
								<th colspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.solved" text="Solved"/></th>
								
								<th rowspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.redressal" text="Redressal in (%)"/></th>
								<th rowspan="2" class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.grade" text="Grade"/></th>
							</tr>
							<tr>
								<th class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.withInTime" text="With in time"/></th>
								<th class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.beyondTime" text="Beyond time"/></th>
								<th class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.withInTime" text="With in time"/></th>
								<th class="text-center" style="vertical-align: middle;"><spring:message code="care.reports.beyondTime" text="Beyond time"/></th>
							</tr>
							
						</thead>
						
						<tbody>
							<c:set var="records" value="0"></c:set>
							<c:set var="totalReceived" value="0"></c:set>
							<c:set var="totalPendingWithinSla" value="0"></c:set>
							<c:set var="totalPendingBeyondSla" value="0"></c:set>
							<c:set var="totalClosedWithinSla" value="0"></c:set>
							<c:set var="totalClosedBeyondSla" value="0"></c:set>
							<c:set var="totalRedressal" value="0"></c:set>
							
							<c:forEach items="${command.complaintReport.complaintGradeSummary}"	var="Summary" varStatus="loop">
								<tr>
									<c:set var="records" value="${loop.index + 1}"></c:set> 
									<td class="text-center"><c:out value="${records}"></c:out></td>
									<td><c:out value="${Summary.department}"/></td>
									<td class="text-center" >
										<c:out value="${Summary.received}"/>
										<c:set var="totalReceived" value="${totalReceived + Summary.received}"></c:set> 
									</td>
									<td class="text-center" >
										<c:out value="${Summary.pendingWithinSla}"/>
										<c:set var="totalPendingWithinSla" value="${totalPendingWithinSla + Summary.pendingWithinSla}"></c:set>
									</td>
									<td class="text-center" >
										<c:out value="${Summary.pendingBeyondSla}"/>
										<c:set var="totalPendingBeyondSla" value="${totalPendingBeyondSla + Summary.pendingBeyondSla}"></c:set>
									</td>
									<td class="text-center" >
										<c:out value="${Summary.closedWithinSla}"/>
										<c:set var="totalClosedWithinSla" value="${totalClosedWithinSla + Summary.closedWithinSla}"></c:set>
									</td>
									<td class="text-center" >
										<c:out value="${Summary.closedBeyondSla}"/>
										<c:set var="totalClosedBeyondSla" value="${totalClosedBeyondSla + Summary.closedBeyondSla}"></c:set>
									</td>
									<td class="text-center" >
										<c:out value="${Summary.redressal}"/>
										<c:set var="totalRedressal" value="${totalRedressal + Summary.redressal}"></c:set>
									</td>
									<td class="text-center" >
										<c:if test="${Summary.grade eq 'A'}">
											<span class="green text-bold">  <c:out value="${Summary.grade}"/> </span>
										</c:if>
										<c:if test="${Summary.grade eq 'B'}">
											<span class="blue text-bold"> <c:out value="${Summary.grade}"/> </span>
										</c:if>
										<c:if test="${Summary.grade eq 'C'}">
											<span class="orange text-bold">  <c:out value="${Summary.grade}"/> </span>
										</c:if>
										<c:if test="${Summary.grade eq 'D'}">
											<span class="red text-bold">  <c:out value="${Summary.grade}"/> </span>
										</c:if>
									</td>
								</tr>
							</c:forEach>
								
						</tbody>
						
						<tfoot>
							<tr class="text-bold totalCount">
									<th ></th>
									<th class="text-center"><spring:message code="care.reports.total" text="Total"/></th>
									<th class="text-center"><c:out value="${totalReceived}"/></th>
									<th class="text-center"><c:out value="${totalPendingWithinSla}"/></th>
									<th class="text-center"><c:out value="${totalPendingBeyondSla}"/></th>
									<th class="text-center"><c:out value="${totalClosedWithinSla}"/></th>
									<th class="text-center"><c:out value="${totalClosedBeyondSla}"/></th>
									<th></th>
									<th></th>
							</tr>
							<tr class="print-remove">
								<th class="ts-pager form-horizontal">
									<div class="btn-group">
										<button type="button" class="btn first"><i class="fa fa-step-backward" aria-hidden="true"></i></button>
										<button type="button" class="btn prev"><i class="fa fa-arrow-left" aria-hidden="true"></i></button>
									</div>
									<span class="pagedisplay"></span> <!-- this can be any element, including an input -->
									<div class="btn-group">
										<button type="button" class="btn next"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>
										<button type="button" class="btn last"><i class="fa fa-step-forward" aria-hidden="true"></i></button>
									</div>
									<select class="pagesize input-mini form-control" title="Select page size">
										<option selected="selected" value="3" class="form-control">10</option>
										<option value="20">20</option>
										<option value="30">30</option>
										<option value="all">All Records</option>
									</select>
									<select class="pagenum input-mini form-control" title="Select page number"></select>
								</th>
							</tr>
						</tfoot>
					</table>
				</div>
				</div>
             <div class="text-center margin-top-10 remove-btn">
              <button onclick="PrintDiv('${command.complaintReport.title}');" class="btn btn-success hidden-print" type="button"><i class="fa fa-print"></i>
              	<spring:message code="care.receipt.print" text="Print"/>
              </button>
              <button type="button" class="btn btn-warning hidden-print" onclick="javascript:openRelatedForm('GrievanceReport.html?grievanceGrading','this');"><spring:message code="care.back" text="Back"/></button>
            </div> 
          </form>
        </div>
      </div>
    </div>